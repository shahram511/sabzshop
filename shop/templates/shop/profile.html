{% extends 'parent/base.html' %}
{% load static %}
{% block title %}profile{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- Messages Section -->
{%if messages %}
<div class="profile-messages">
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
</div>
{% endif %}

<!-- Profile Header -->
<div class="profile-header">
    <div class="profile-header-content">
        <div class="profile-avatar">
            <i class="fas fa-user-circle"></i>
        </div>
        <h1 class="profile-title">پروفایل من</h1>
    </div>
</div>

<!-- Main Profile Container -->
<div class="profile-container">
    <!-- Profile Info Card -->
    <div class="profile-card">
        <div class="card-header">
            <h2><i class="fas fa-user"></i> اطلاعات شخصی</h2>
        </div>
        <div class="card-body">
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label"><i class="fas fa-signature"></i> نام:</span>
                    <span class="info-value">{{ user.first_name|default:"-" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label"><i class="fas fa-user"></i> نام خانوادگی:</span>
                    <span class="info-value">{{ user.last_name|default:"-" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label"><i class="fas fa-envelope"></i> ایمیل:</span>
                    <span class="info-value">{{ user.email }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label"><i class="fas fa-phone"></i> شماره تلفن:</span>
                    <span class="info-value">{{ user.phone|default:"-" }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Form Card -->
    <div class="profile-card">
        <div class="card-header">
            <h2><i class="fas fa-edit"></i> ویرایش اطلاعات</h2>
        </div>
        <div class="card-body">
            <form method="post" class="profile-form">
                {% csrf_token %}
                <div class="form-group">
                    {{ form.as_p }}
                </div>
                <button type="submit" class="btn-submit">
                    <i class="fas fa-save"></i> ذخیره تغییرات
                </button>
            </form>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="profile-card">
        <div class="card-header">
            <h2><i class="fas fa-bolt"></i> دسترسی سریع</h2>
        </div>
        <div class="card-body">
            <div class="action-buttons">
                <a href="{% url 'shop:product_list' %}" class="action-btn btn-primary">
                    <i class="fas fa-home"></i> بازگشت به صفحه اصلی
                </a>
                <a href="{% url 'shop:return_product' %}" class="action-btn btn-warning">
                    <i class="fas fa-undo"></i> مرجوع کالا
                </a>
                <a href="{% url 'shop:logout' %}" class="action-btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i> خروج
                </a>
            </div>
        </div>
    </div>

    <!-- Orders Section -->
    <div class="profile-card orders-card">
        <div class="card-header">
            <h2><i class="fas fa-shopping-bag"></i> سفارشات من</h2>
        </div>
        <div class="card-body">
            {% include 'order_list.html' %}
        </div>
    </div>

    <!-- Favorite Products Section -->
    <div class="profile-card favorites-card">
        <div class="card-header">
            <h2><i class="fas fa-heart"></i> محصولات مورد علاقه</h2>
        </div>
        <div class="card-body">
            {% if user.favorite_products.all %}
                <div class="favorites-grid">
                    {% for product in user.favorite_products.all %}
                        <div class="favorite-item">
                            <a href="{{ product.get_absolute_url }}" class="favorite-link">
                                <div class="favorite-image">
                                    {% if product.images.first %}
                                        <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}">
                                    {% else %}
                                        <img src="{% static 'images/no-image.png' %}" alt="No image">
                                    {% endif %}
                                    <div class="favorite-overlay">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                </div>
                                <div class="favorite-info">
                                    <h3 class="favorite-name">{{ product.name }}</h3>
                                    {% if product.description %}
                                        <p class="favorite-description">{{ product.description|truncatewords:15 }}</p>
                                    {% endif %}
                                    <div class="favorite-price">
                                        {% if product.off > 0 %}
                                            <span class="old-price">{{ product.price }} تومان</span>
                                            <span class="new-price">{{ product.new_price }} تومان</span>
                                        {% else %}
                                            <span class="new-price">{{ product.price }} تومان</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </a>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <i class="fas fa-heart-broken"></i>
                    <p>شما هنوز محصولی را به علاقه‌مندی‌ها اضافه نکرده‌اید.</p>
                    <a href="{% url 'shop:product_list' %}" class="btn-primary">مشاهده محصولات</a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}