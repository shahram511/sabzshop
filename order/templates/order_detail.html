{% extends 'parent/base.html' %}
{% load static %}

{% block title %}جزئیات سفارش #{{ order.id }}{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/order_detail.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
    /* Hide shopping cart on order detail page */
    .cart-container {
        display: none !important;
    }
</style>

<!-- Header Section -->
<div class="order-detail-header">
    <div class="header-content">
        <h1><i class="fas fa-clipboard-list"></i> جزئیات سفارش</h1>
        <p class="header-subtitle">شماره سفارش: #{{ order.id }}</p>
    </div>
</div>

<!-- Main Container -->
<div class="order-detail-container">
    <!-- Order Info Card -->
    <div class="order-info-card">
        <h2><i class="fas fa-info-circle"></i> اطلاعات سفارش</h2>
        <div class="info-grid">
            <div class="info-item">
                <div class="info-label">
                    <i class="fas fa-hashtag"></i> شماره سفارش
                </div>
                <div class="info-value">#{{ order.id }}</div>
            </div>
            <div class="info-item">
                <div class="info-label">
                    <i class="fas fa-calendar-alt"></i> تاریخ سفارش
                </div>
                <div class="info-value">{{ order.created|date:"Y/m/d H:i" }}</div>
            </div>
            <div class="info-item">
                <div class="info-label">
                    <i class="fas fa-money-bill-wave"></i> مبلغ سفارش
                </div>
                <div class="info-value highlight">{{ order.get_total_price_with_post|floatformat:0 }} تومان</div>
            </div>
            <div class="info-item">
                <div class="info-label">
                    <i class="fas fa-credit-card"></i> وضعیت پرداخت
                </div>
                <div class="info-value">
                    {% if order.paid %}
                    <span class="status-badge paid">
                        <i class="fas fa-check-circle"></i> پرداخت شده
                    </span>
                    {% else %}
                    <span class="status-badge unpaid">
                        <i class="fas fa-times-circle"></i> پرداخت نشده
                    </span>
                    {% endif %}
                </div>
            </div>
            <div class="info-item">
                <div class="info-label">
                    <i class="fas fa-truck"></i> وضعیت سفارش
                </div>
                <div class="info-value">
                    <span class="status-badge status-{{ order.order_status }}">
                        {{ order.get_order_status_display }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Information Card -->
    <div class="customer-info-card">
        <h2><i class="fas fa-user"></i> اطلاعات خریدار</h2>
        <div class="customer-grid">
            {% if order.buyer %}
            <div class="customer-item">
                <div class="customer-label">
                    <i class="fas fa-user"></i> نام و نام خانوادگی
                </div>
                <div class="customer-value">{{ order.buyer.first_name }} {{ order.buyer.last_name }}</div>
            </div>
            <div class="customer-item">
                <div class="customer-label">
                    <i class="fas fa-phone"></i> شماره تلفن
                </div>
                <div class="customer-value">{{ order.buyer.phone }}</div>
            </div>
            {% endif %}
            <div class="customer-item">
                <div class="customer-label">
                    <i class="fas fa-envelope"></i> ایمیل
                </div>
                <div class="customer-value">{{ order.email }}</div>
            </div>
            <div class="customer-item">
                <div class="customer-label">
                    <i class="fas fa-city"></i> شهر
                </div>
                <div class="customer-value">{{ order.city }}</div>
            </div>
            {% if order.province %}
            <div class="customer-item">
                <div class="customer-label">
                    <i class="fas fa-map-marked-alt"></i> استان
                </div>
                <div class="customer-value">{{ order.province }}</div>
            </div>
            {% endif %}
            <div class="customer-item full-width">
                <div class="customer-label">
                    <i class="fas fa-home"></i> آدرس
                </div>
                <div class="customer-value">{{ order.address }}</div>
            </div>
            {% if order.postal_code %}
            <div class="customer-item">
                <div class="customer-label">
                    <i class="fas fa-mail-bulk"></i> کد پستی
                </div>
                <div class="customer-value">{{ order.postal_code }}</div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Order Items Card -->
    <div class="order-items-card">
        <h2><i class="fas fa-box"></i> اقلام سفارش</h2>
        <div class="items-table-wrapper">
            <table class="items-table">
                <thead>
                    <tr>
                        <th class="col-product">محصول</th>
                        <th class="col-category">دسته بندی</th>
                        <th class="col-price">قیمت واحد</th>
                        <th class="col-quantity">تعداد</th>
                        <th class="col-weight">وزن (گرم)</th>
                        <th class="col-total">قیمت کل</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order.items.all %}
                    <tr>
                        <td class="col-product">
                            <div class="product-info">
                                {% if item.product.images.first %}
                                <img src="{{ item.product.images.first.image.url }}" alt="{{ item.product.name }}" class="product-image">
                                {% else %}
                                <div class="product-image-placeholder">
                                    <i class="fas fa-image"></i>
                                </div>
                                {% endif %}
                                <span class="product-name">{{ item.product.name }}</span>
                            </div>
                        </td>
                        <td class="col-category">{{ item.product.category.name }}</td>
                        <td class="col-price">{{ item.price|floatformat:0 }} تومان</td>
                        <td class="col-quantity">{{ item.quantity }}</td>
                        <td class="col-weight">{{ item.weight|floatformat:0 }}</td>
                        <td class="col-total"><strong>{{ item.get_cost|floatformat:0 }} تومان</strong></td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="empty-row">
                            <i class="fas fa-inbox"></i>
                            هیچ آیتمی در این سفارش وجود ندارد
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Price Summary Card -->
    <div class="price-summary-card">
        <h2><i class="fas fa-calculator"></i> خلاصه قیمت</h2>
        <div class="summary-details">
            <div class="summary-row">
                <span><i class="fas fa-shopping-bag"></i> جمع محصولات:</span>
                <strong>{{ order.get_total_price|floatformat:0 }} تومان</strong>
            </div>
            <div class="summary-row">
                <span><i class="fas fa-truck"></i> هزینه ارسال:</span>
                <strong>{{ order.get_post_price|floatformat:0 }} تومان</strong>
            </div>
            <div class="summary-divider"></div>
            <div class="summary-row final-row">
                <span><i class="fas fa-money-bill-wave"></i> مبلغ کل:</span>
                <strong class="final-price">{{ order.get_total_price_with_post|floatformat:0 }} تومان</strong>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        {% if order.paid %}
        <a href="{% url 'order:invoice' order.id %}" class="btn btn-invoice">
            <i class="fas fa-file-invoice"></i> مشاهده فاکتور
        </a>
        {% endif %}
        <a href="{% url 'order:order_list' %}" class="btn btn-orders">
            <i class="fas fa-list"></i> بازگشت به لیست سفارشات
        </a>
        <a href="{% url 'shop:product_list' %}" class="btn btn-shop">
            <i class="fas fa-store"></i> بازگشت به فروشگاه
        </a>
    </div>
</div>
{% endblock %}
